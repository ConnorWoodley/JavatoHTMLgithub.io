<!doctype html>
<html lang="en">

<head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/p5.min.js"></script>
</head>

<body>
    <script type="text/javascript">
let stars = [], numofstars = 500, varia;
let song, analyzer;


function preload() {
  soundFormats('mp3');
  song = loadSound('/assets/song1');
}
function setup() {
  createCanvas(windowWidth-20,windowHeight-20);

  /* Music Focus Section
    song.loop();

    // create a new Amplitude analyzer
    analyzer = new p5.Amplitude();

    // Patch the input to an volume analyzer
    analyzer.setInput(song);
  /* Music Focus Section */

  varia = sqrt(width*height)/2;
  for (let i = 0; i < numofstars; i += 1) {
    let star = new Star(random(0,width), random(0,height));
    stars.push(star);
  }
}

function draw() {
  background(0);

  /* Music Focus Section 
    let level = analyzer.getLevel();

    // Create multiple bars
    for(let i = 0; i < 10; i++) {
      let barHeight = map(level, 0, 1, 10, height);
      let x = width * i/10;
     rect(x, height - barHeight, width/12, barHeight);
    }
   Music Focus Section */

  for (let star of stars) {
    star.move();
    star.show();
  }
}

class Star {
  constructor(tempx, tempy) {
    this.xstart = tempx;
    this.x = tempx;
    this.ystart = tempy;
    this.y = tempy;
    this.x += cos(atan2(this.ystart-height/2,this.xstart-width/2))*100;
    this.y += sin(atan2(this.ystart-height/2,this.xstart-width/2))*100;
  }

  move() {
    this.dis = dist(this.x,this.y,this.xstart,this.ystart);
    this.size = sqrt(this.dis/2);
    
    this.a = atan2(this.y-height/2,this.x-width/2);
    this.x += cos(this.a)*(this.dis/varia);
    this.y += sin(this.a)*(this.dis/varia);
    
    if (dist(this.x,this.y,width/2,height/2)>sqrt(width*height)) {this.xstart=random(0,width); 
      this.ystart=random(0,height); this.size=0;
      this.x=this.xstart+cos(this.a);
      this.y=this.ystart+sin(this.a);}
  }
  
  
  show() {
    strokeWeight(0);
    circle(this.x,this.y,this.size-1);
  }
}
    </script>
</body>

</html>
